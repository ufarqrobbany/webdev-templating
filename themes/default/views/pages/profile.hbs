<div class="profile-page px-4">

  {{!-- Header biru gradient di atas profil --}}
  <div class="profile-cover"></div>

  {{!-- Card Profil Utama --}}
  <div class="profile-card card">

    {{!-- Foto Profil (Unified avatar style) --}}
    <div class="profile-avatar-container" style="display:flex; align-items:center; justify-content:center;">
      <div class="avatar avatar-lg {{userGradient profileUser.id}}" style="width:120px; height:120px; font-size:40px; position:relative; overflow:hidden;">
        {{#if profileUser.photo}}
          <img 
            src="https://pub-ff20b5ae86d9421f9cae641000e402ce.r2.dev/{{profileUser.photo.path}}" 
            alt="{{profileUser.firstName}} {{profileUser.lastName}}" 
            class="avatar-img" 
            style="width:100%; height:100%; object-fit:cover; border-radius:inherit;" 
          />
        {{else}}
          {{slice profileUser.firstName 0 1}}{{slice profileUser.lastName 0 1}}
        {{/if}}
      </div>
    </div>

    {{!-- Info Profil --}}
    <div class="profile-info">
      <h2 class="profile-name">{{profileUser.firstName}} {{profileUser.lastName}}</h2>
      <p class="profile-username">{{profileUser.bio}}</p>
    </div>

    {{!-- Statistik Profil --}}
    <div class="profile-stats modern">
      <div>
        <span>{{posts.length}}</span>
        <p>Postingan</p>
      </div>
      <div>
        <span>{{followersCount}}</span>
        <p>Pengikut</p>
      </div>
      <div>
        <span>{{followingCount}}</span>
        <p>Mengikuti</p>
      </div>
    </div>

    {{!-- Tombol Follow / Edit Profil (Modern) --}}
    {{#if user}}
      <div class="profile-actions modern" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:22px;">
        {{#unless (eq profileUser.id user.id)}}
          {{#if isFollowing}}
            <form action="/api/v1/users/{{profileUser.id}}/unfollow" method="POST" style="margin:0;">
              <button type="submit" class="btn-unfollow-modern" aria-label="Unfollow {{profileUser.firstName}}"><i class="fas fa-user-minus"></i><span>Unfollow</span></button>
            </form>
          {{else}}
            <form action="/api/v1/users/{{profileUser.id}}/follow" method="POST" style="margin:0;">
              <button type="submit" class="btn-follow-modern" aria-label="Follow {{profileUser.firstName}}">+ Follow</button>
            </form>
          {{/if}}
          {{else}}
            <a href="/api/v1/auth/profile/edit" class="btn btn-accent">Edit Profil</a>
        {{/unless}}
      </div>
    {{/if}}
  </div>

  {{!-- Daftar Postingan --}}
  <div class="profile-posts">
    <h3 class="section-title-modern">Postingan</h3>

    {{#if posts.length}}
      {{#each posts}}
        {{> _post-item this}}
      {{/each}}
    {{else}}
      <div class="card text-center">
        <p>Belum ada postingan.</p>
      </div>
    {{/if}}
  </div>
</div>

{{!-- ==================================== --}}
{{!-- Script opsional: preview upload foto --}}
{{!-- ==================================== --}}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const btnUpload = document.getElementById("btn-upload-pic");
    const inputFile = document.getElementById("file-upload-input");
    const avatarImg = document.querySelector(".profile-avatar");

    if (btnUpload && inputFile && avatarImg) {
      btnUpload.addEventListener("click", () => inputFile.click());

      inputFile.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          avatarImg.src = reader.result;
          avatarImg.classList.add("loading");
          setTimeout(() => avatarImg.classList.remove("loading"), 700);
        };
        reader.readAsDataURL(file);
      });
    }
  });
</script>
