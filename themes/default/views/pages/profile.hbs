{{!-- ===================================================== --}}
{{!-- File: themes/default/views/pages/profile.hbs --}}
{{!-- Halaman Profil (Desain Modern, sesuai screenshot) --}}
{{!-- ===================================================== --}}

{{!-- ====================== --}}
{{!-- Bagian Konten Profil --}}
{{!-- ====================== --}}
<div class="profile-page px-4">

  {{!-- Header biru gradient di atas profil --}}
  <div class="profile-cover"></div>

  {{!-- Card Profil Utama --}}
  <div class="profile-card card">

    {{!-- Foto Profil (Unified avatar style) --}}
    <div class="profile-avatar-container" style="display:flex; align-items:center; justify-content:center;">
      <div class="avatar avatar-lg {{userGradient profileUser.id}}" style="width:120px; height:120px; font-size:40px; position:relative; overflow:hidden;">
        {{#if profileUser.photo}}
          <img src="{{profileUser.photo.path}}" alt="{{profileUser.firstName}} {{profileUser.lastName}}" class="avatar-img" style="width:100%; height:100%; object-fit:cover; border-radius:inherit;" />
        {{else}}
          {{userInitials profileUser.firstName profileUser.lastName}}
        {{/if}}
      </div>
      {{!-- Tombol Ganti Foto Profil (hanya untuk pemilik) --}}
      {{!-- {{#if user}}
        {{#if (eq profileUser.id user.id)}}
          <button class="btn-upload-pic" id="btn-upload-pic" aria-label="Ganti foto profil" style="position:absolute; bottom:8px; right:8px; background:rgba(0,0,0,0.55); color:#fff; width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; border:none; cursor:pointer; transition:background .2s;">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
              <path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
              <path d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 
              2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2zm.5 
              2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm9 
              2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 
              7 0z"/>
            </svg>
          </button>
          <input type="file" id="file-upload-input" accept="image/*" hidden>
        {{/if}}
      {{/if}} --}}
    </div>

    {{!-- Info Profil --}}
    <div class="profile-info">
      <h2 class="profile-name">{{profileUser.firstName}} {{profileUser.lastName}}</h2>
      <p class="profile-username">Mahasiswa Politeknik Negeri Bandung</p>
    </div>

    {{!-- Statistik Profil --}}
    <div class="profile-stats modern">
      <div>
        <span>{{posts.length}}</span>
        <p>Postingan</p>
      </div>
      <div>
        <span>{{followersCount}}</span>
        <p>Pengikut</p>
      </div>
      <div>
        <span>{{followingCount}}</span>
        <p>Mengikuti</p>
      </div>
    </div>

    {{!-- Tombol Follow / Edit Profil (Modern) --}}
    {{#if user}}
      <div class="profile-actions modern" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:22px;">
        {{#unless (eq profileUser.id user.id)}}
          {{#if isFollowing}}
            <form action="/api/v1/users/{{profileUser.id}}/unfollow" method="POST" style="margin:0;">
              <button type="submit" class="btn-unfollow-modern" aria-label="Unfollow {{profileUser.firstName}}"><i class="fas fa-user-minus"></i><span>Unfollow</span></button>
            </form>
          {{else}}
            <form action="/api/v1/users/{{profileUser.id}}/follow" method="POST" style="margin:0;">
              <button type="submit" class="btn-follow-modern" aria-label="Follow {{profileUser.firstName}}">+ Follow</button>
            </form>
          {{/if}}
        {{else}}
          <a href="/api/v1/auth/profile/edit" class="btn-edit-profile-modern" aria-label="Edit Profil"><i class="fas fa-user-pen mr-2"></i><span>Edit Profil</span></a>
        {{/unless}}
      </div>
    {{/if}}
  </div>

  {{!-- Daftar Postingan --}}
  <div class="profile-posts">
    <h3 class="section-title-modern">Postingan</h3>

    {{#if posts.length}}
      {{#each posts}}
        {{> _post-item this}}
      {{/each}}
    {{else}}
      <div class="card text-center">
        <p>Belum ada postingan.</p>
      </div>
    {{/if}}
  </div>
</div>

{{!-- ==================================== --}}
{{!-- Script opsional: preview upload foto --}}
{{!-- ==================================== --}}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const btnUpload = document.getElementById("btn-upload-pic");
    const inputFile = document.getElementById("file-upload-input");
    const avatarImg = document.querySelector(".profile-avatar");

    if (btnUpload && inputFile && avatarImg) {
      btnUpload.addEventListener("click", () => inputFile.click());

      inputFile.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          avatarImg.src = reader.result;
          avatarImg.classList.add("loading");
          setTimeout(() => avatarImg.classList.remove("loading"), 700);
        };
        reader.readAsDataURL(file);
      });
    }
  });
</script>
